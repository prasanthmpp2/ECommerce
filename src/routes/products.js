const express = require('express');\nconst { authenticate, requireRole } = require('../middleware/authenticate');\nconst authenticateApiKeyFactory = require('../middleware/authenticateApiKey');\n\nmodule.exports = (prisma) => {\n  const router = express.Router();\n  const authenticateApiKey = authenticateApiKeyFactory(prisma);\n\n  // Public listing\n  router.get('/', async (req, res) => {\n    const products = await prisma.product.findMany({\n      orderBy: { createdAt: 'desc' },\n      take: 100\n    });\n    res.json(products);\n  });\n\n  // Add product via web UI (must be logged in & admin)\n  router.post('/add', authenticate, requireRole('admin'), async (req, res) => {\n    const { title, description, image, price } = req.body;\n    if (!title || !price) return res.status(400).json({ error: 'Missing fields' });\n\n    const product = await prisma.product.create({\n      data: {\n        title,\n        description,\n        image,\n        price: parseFloat(price),\n        createdBy: req.user.userId\n      }\n    });\n    res.json(product);\n  });\n\n  // Add product via API key (machine-to-machine)\n  router.post('/apikey', authenticateApiKey, async (req, res) => {\n    const { title, description, image, price } = req.body;\n    if (!title || !price) return res.status(400).json({ error: 'Missing fields' });\n\n    const product = await prisma.product.create({\n      data: {\n        title,\n        description,\n        image,\n        price: parseFloat(price)\n      }\n    });\n    res.json({ message: 'Created', product });\n  });\n\n  return router;\n};